<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Web AR Viewer</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script
      type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.js"
    ></script>

    <script
      nomodule
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"
    ></script>

    <script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.1.3/webcomponents-loader.js"></script>

    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>

    <script src="https://unpkg.com/resize-observer-polyfill@1.5.1/dist/ResizeObserver.js"></script>

    <link rel="stylesheet" href="ContainerStyle.css" />
  </head>
  <body>
    <model-viewer
      src="./MetalTable.glb"
      ios-src="./MetalTable.usdz"
	  environment-image="neutral"
      ar
      auto-rotate
	  shadow-intensity="0.8"
	  camera-controls
    >
	
	<button class="Hotspot" id ="anectode" slot="hotspot-7" data-position="0m 0.46m 0m" data-normal="-0m 0m 0m"> <div id="annotation">sample</div></button>
	<p>Model name</p>
      <p id="model-name">None</p>
    </model-viewer>
	<form>
		Model Name:<br> <input type="text" name="name", id="ModelName">
		<input type="button" onclick="switchSrc(this,name)" value="Submit">
	</form>
	<script type="module">
	   const modelViewer = document.querySelector("model-viewer");
	   const div = document.getElementById('annotation'); 
	   
	   window.switchSrc = (element, index) => {	
		const mName = document.getElementById('ModelName').value; 
		const base = "./" + mName;
		modelViewer.src = base + '.glb';
		modelViewer.iosSrc = base + '.usdz';
		
		const a = modelViewer.src;
		document.querySelector('#model-name').innerText = mName;
		div.innerHTML = mName + "\n" +a.size;
		
		urlExists(a).then(result=>{
			console.log(result);
		});
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", a, true);
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.send(null);

		var client = new HttpClient();
		client.get(a, function(response) {
			console.log(response);
			response.statusCode;
			const c= response.statusCode;
		    console.log(c);
		    const b = response.header.get('content-length');
		    console.log(b);
		});		
				
		

	  };
	  
	   function urlExists(url) {
        return new Promise((resolve,reject)=>{
          var request = new Request(url);
          fetch(request).then(function(response) {
             resolve(response.status != 404);
          });
        });
		}	
	  
	   var HttpClient = function() {
		this.get = function(aUrl, aCallback) {
        var anHttpRequest = new XMLHttpRequest();
        anHttpRequest.onreadystatechange = function() { 
            if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                aCallback(anHttpRequest.responseText);
        }

        anHttpRequest.open( "GET", aUrl, true );            
        anHttpRequest.send( null );
    }
}
	</script>
  </body>
</html>
